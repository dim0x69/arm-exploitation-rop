#!/bin/bash

cur=$(pwd)

mkdir archlinux
cd archlinux

cp ../ArchLinuxARM-armv7-latest.tar.gz .

tar xf ArchLinuxARM-armv7-latest.tar.gz
cd boot
mkdir initramfs
cp initramfs-linux.img initramfs
cd initramfs
gzip -d -S .img initramfs-linux.img
bsdcpio -i <initramfs-linux
rm initramfs-linux
cd ../../
cp -r lib/modules boot/initramfs/lib/
cd boot/initramfs 
find -mindepth 1 -printf "%P\0" | bsdcpio -0 -o -H newc -R 0:0 > ../initramfs-linux-full.img
cp ../initramfs-linux-full.img ${cur}/
cd ${cur}
