#!/bin/bash


cur=$(pwd)

qemu-img create -f raw armbox.img 4G

sudo losetup /dev/loop0 armbox.img

sudo parted /dev/loop0 mklabel msdos
sudo parted -a optimal /dev/loop0 mkpart primary 0% 100%

sudo mkfs.ext4 /dev/loop0p1
sudo mount -t ext4 /dev/loop0p1 /mnt

cd /mnt
sudo cp ${cur}/ArchLinuxARM-armv7-latest.tar.gz .
sudo tar xzf ArchLinuxARM-armv7-latest.tar.gz

cd ${cur}

sudo losetup -d /dev/loop0
sudo umount /mnt
